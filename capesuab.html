<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Declaração de Não-Acúmulo de Bolsas UAB</title>

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }

    form {
      max-width: 600px;
      margin: auto;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 10px;
      background-color: #f9f9f9;
    }

    label {
      font-weight: bold;
    }

    input, select, button {
      width: 100%;
      padding: 8px;
      margin: 10px 0;
      display: block;
      box-sizing: border-box;
    }

    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 10px;
      cursor: pointer;
    }

    button:hover {
      background-color: #45a049;
    }

    /* LOGO CAPES – padrão de uso digital (marca vertical) */
    .logo {
      text-align: center;
      margin-bottom: 20px;
    }

    .logo img {
      width: 231px;
      height: auto;
      max-width: 70vw;
    }

    .signature {
      margin-top: 50px;
      height: 50px;
      border-bottom: 1px solid black;
      text-align: center;
    }
  </style>
</head>

<body>

  <div class="logo">
    <img src="https://upload.wikimedia.org/wikipedia/commons/0/08/Identidade_Visual_CAPES.png" alt="Logo CAPES">
  </div>

  <form id="declaracaoForm">
    <h2 style="text-align: center;"><strong>Declaração de Pagamento de Bolsas UAB</strong></h2>

    <label for="nome">Nome Completo:</label>
    <input type="text" id="nome" required autocomplete="name">

    <label for="cpf">CPF:</label>
    <input type="text" id="cpf" required placeholder="000.000.000-00" inputmode="numeric">

    <label for="modalidade">Modalidade:</label>
    <select id="modalidade" required>
      <option value="">Selecione...</option>
      <option value="Professor Formador">Professor Formador</option>
      <option value="Tutor Presencial">Tutor Presencial</option>
      <option value="Tutor a Distância">Tutor a Distância</option>
      <option value="Professor Conteudista">Professor Conteudista</option>
      <option value="Assistente Pedagógico">Assistente Pedagógico</option>
      <option value="Coordenador de Curso">Coordenador de Curso</option>
    </select>

    <label for="data">Data:</label>
    <input type="date" id="data" required>

    <p style="text-align: justify;">
      Declaro que não possuo outros pagamentos de bolsas em desacordo com a Lei nº 11.273,
      de 06 de fevereiro de 2006, portarias conjuntas CAPES/CNPq nº 01/2013 e nº 2/2014,
      demais legislações correlatas e suas eventuais atualizações.
    </p>

    <div class="signature">Assinatura do Declarante</div>

    <button type="submit">Gerar Declaração</button>
  </form>

  <script>
    // =======================
    // NORMALIZAÇÃO DE NOME
    // =======================
    const PARTICULAS_MINUSCULAS = new Set(["da", "de", "do", "das", "dos", "e"]);

    function capitalizarNome(valor) {
      return valor
        .toLowerCase()
        .trim()
        .replace(/\s+/g, " ")
        .split(" ")
        .map((p, i) => {
          if (i !== 0 && PARTICULAS_MINUSCULAS.has(p)) return p;
          return p.charAt(0).toUpperCase() + p.slice(1);
        })
        .join(" ");
    }

    // =======================
    // MÁSCARA CPF
    // =======================
    function formatarCPF(valor) {
      return valor
        .replace(/\D/g, "")
        .slice(0, 11)
        .replace(/(\d{3})(\d)/, "$1.$2")
        .replace(/(\d{3})(\d)/, "$1.$2")
        .replace(/(\d{3})(\d{1,2})$/, "$1-$2");
    }

    // Eventos de input
    const inputNome = document.getElementById("nome");
    const inputCPF = document.getElementById("cpf");

    inputNome.addEventListener("blur", () => {
      inputNome.value = capitalizarNome(inputNome.value);
    });

    inputCPF.addEventListener("input", () => {
      inputCPF.value = formatarCPF(inputCPF.value);
    });

    // =======================
    // PDF
    // =======================
    document.getElementById("declaracaoForm").addEventListener("submit", function (e) {
      e.preventDefault();
      gerarPDF();
    });

    function formatarDataPorExtenso(data) {
      const meses = [
        "janeiro","fevereiro","março","abril","maio","junho",
        "julho","agosto","setembro","outubro","novembro","dezembro"
      ];
      const partes = data.split("-");
      return `${partes[2]} de ${meses[parseInt(partes[1]) - 1]} de ${partes[0]}`;
    }

    function gerarPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ orientation: "p", unit: "mm", format: "a4" });

      const pageWidth = doc.internal.pageSize.getWidth();
      const margemEsquerda = 20;
      const larguraTexto = 170;

      // Logo CAPES (vertical) centralizada
      const logoW = 40;
      const logoH = 40;
      const logoX = (pageWidth - logoW) / 2;
      const logoY = 10;

      doc.addImage(
        "https://upload.wikimedia.org/wikipedia/commons/0/08/Identidade_Visual_CAPES.png",
        "PNG",
        logoX,
        logoY,
        logoW,
        logoH
      );

      let posicaoY = logoY + logoH + 15;

      doc.setFont("helvetica", "bold");
      doc.setFontSize(14);
      doc.text(
        "Declaração de Não-Acúmulo de Bolsas UAB",
        pageWidth / 2,
        posicaoY,
        { align: "center" }
      );

      posicaoY += 15;

      const nome = capitalizarNome(inputNome.value);
      const cpf = formatarCPF(inputCPF.value);
      const modalidade = document.getElementById("modalidade").value;
      const data = document.getElementById("data").value;
      const dataExtenso = formatarDataPorExtenso(data);

      const texto = `Eu, ${nome}, CPF ${cpf}, bolsista da modalidade ${modalidade} do Sistema UAB, declaro que não possuo outros pagamentos de bolsas em desacordo com a legislação vigente.`;

      doc.setFont("helvetica", "normal");
      doc.setFontSize(12);
      doc.text(
        texto,
        margemEsquerda,
        posicaoY,
        {
          maxWidth: larguraTexto,
          align: "justify"
        }
      );

      posicaoY += 40;

      doc.text(
        `Cuiabá - MT, ${dataExtenso}`,
        margemEsquerda,
        posicaoY
      );

      posicaoY += 35;

      doc.text(
        "______________________________________________",
        pageWidth / 2,
        posicaoY,
        { align: "center" }
      );

      posicaoY += 10;

      doc.text(
        nome,
        pageWidth / 2,
        posicaoY,
        { align: "center" }
      );

      doc.save("Declaracao_Nao_Acumulo_Bolsas_UAB.pdf");
    }
  </script>

</body>
</html>

